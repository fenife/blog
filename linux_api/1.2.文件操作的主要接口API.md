
## 1.2.文件操作的主要接口API

先介绍操作系统API的概念，然后介绍文件IO的概念以及常用的API，最后讲了文件描述符。

#### 1.2.1、什么是操作系统API
1. `API`是一些函数，这些函数是由**linux系统**提供支持的，由应用层程序来使用。
2. 应用层程序通过调用API来调用操作系统中的各种功能，来干活。
3. 学习一个操作系统，其实就是学习使用这个操作系统的API。
4. 要使用linux系统来读写文件，手段就是学习linux系统API中和文件`IO`有关的几个。

#### 1.2.2、linux常用文件IO接口
1. `open`、`close`、`write`、`read`、`lseek`

#### 1.2.3、文件操作的一般步骤
1. 在linux系统中要操作一个文件，一般是先`open`打开一个文件，得到一个**文件描述符**，然后对文件进行读写操作（或其他操作），最后`close`关闭文件即可
2. 强调一点：对文件进行操作时，一定要先打开文件，`打开成功`后才能去操作（如果打开本身失败，后面就不用操作了）；最后读写完成之后一定要`close关闭文件`，否则可能会造成文件损坏。
3. 文件平时是存在**块设备**中的文件系统中的，我们把这种文件叫`静态文件`。当我们去`open`打开一个文件时，linux内核做的操作包括：
    - 内核在进程中建立了一个打开文件的**数据结构**，记录下我们打开的这个文件；
    - 内核在内存中申请一段**内存**，并且将静态文件的内容从块设备中读取到内存中特定地址管理存放（叫`动态文件`）。
4. 打开文件后，以后对这个文件的读写操作，都是针对内存中这一份`动态文件`的，而并不是针对*静态文件*的。当我们对动态文件进行读写后，此时内存中的动态文件和块设备中的静态文件就不同步了，当我们`close`关闭动态文件时，内部内核将内存中的动态文件的内容去更新（`同步`）（保存）块设备中的静态文件。（类似uboot中的环境变量）
5. 常见的一些现象：
    - 第一个：打开一个大文件时比较慢（读块设备）
    - 第二个：我们写了一半的文件，如果没有点保存直接关机/断电，重启后文件内容丢失。

6. 为什么要这么设计？
    - 因为块设备本身有读写限制（回忆NnadFlash、SD等块设备的读写特征），只能执行块操作，不能按字节操作，本身对块设备进行操作非常不灵活。
    - 而内存可以按**字节**为单位来操作，而且可以**随机**操作（内存就叫RAM，random），很灵活。所以内核设计文件操作时就这么设计了。

#### 1.2.4、重要概念：文件描述符
1. 文件描述符其实实质是一个数字，这个数字在一个**进程**中表示一个特定的含义，当我们`open`打开一个文件时，操作系统在内存中构建了一些数据结构来表示这个动态文件，然后返回给应用程序一个数字作为文件描述符，这个数字就和我们内存中维护这个动态文件的这些数据结构挂钩绑定上了，以后我们应用程序如果要操作这一个动态文件，只需要用这个文件描述符进行区分。
2. 一句话讲清楚文件描述符：文件描述符就是用来区分一个程序打开的多个文件的。
3. 文件描述符的作用域就是**当前进程**，出了当前进程这个文件描述符就没有意义了
